<html>
<head>
    <script src='../jquery.js'></script>
    <script src='../lowpro.jquery.js'></script>
    <script>

    //The 2D renderer, toolkit used for drawing the world
    var Renderer = $.klass({

        canvasElm : "",
        context2D : "",
        canvasSizeX : 0, //the real size of the canvas element on-screen
        canvasSizeY : 0,
        drawingSizeX : 0, //the size of the drawed elements alltogether (how many pixels wide the drawing is)
        drawingSizeY : 0, 
        fitDrawingToCanvas : true,
        initialize: function(canvasElm) {
            this.canvasElm = canvasElm = $(canvasElm).get(0);
            //make the canvas have 'real' width and height instead of arbitrary CSS width and height
            $(canvasElm).attr("width",$(canvasElm).width());
            $(canvasElm).attr("height",$(canvasElm).height());
            //now store the sizes
            this.canvasSizeX = $(canvasElm).width();
            this.canvasSizeY = $(canvasElm).height();         
            this.context2D = canvasElm.getContext('2d');
        },

        clear: function() {
            this.context2D.clearRect(0,0,this.canvasSizeX,this.canvasSizeY); //clear that part of the canvas that is on-screen
        },

        translateCoords: function() {
            //(assuming x,y,width,height as arguments)
            //translate the coords from the drawing to the canvas
            //if fitDrawingToCanvas is enabled, then fit the drawing on how wide/high the canvas is
            if (this.fitDrawingToCanvas == true) {
                //find out whether Width of Height is the most restraining factor
                //thus if the translation should be on basis of Width or Height
                if (this.drawingSizeX / this.canvasSizeX > this.drawingSizeY / this.drawingSizeY) {
                    //restraint on height
                    factor = this.canvasSizeX / this.drawingSizeX;
                    return Array(arguments[0] * factor, arguments[1] * factor, arguments[2] * factor, arguments[3] * factor, arguments[4] * factor);
                } else {
                    //restraint on width
                    factor = this.canvasSizeY / this.drawingSizeY;
                    return Array(arguments[0] * factor, arguments[1] * factor, arguments[2] * factor, arguments[3] * factor, arguments[4] * factor);
                }
            } else {
                //otherwise, just return
                return arguments;
            }
            
        },

        //set  the fill in either 
        //- one string (CSS3 format, = #fff or rgb(255,255,255) or rgba(255,255,255,1))
        //- two values, hex and alpha (0-1)
        //- three values, r,g,b
        //- four values, r,g,b and alpha (0-1)
        setFill: function() {
            if (arguments.length == 1) {
                //one string
                this.context2D.fillStyle = arguments[0];
            } else if (arguments.length == 2) {
                //two strings, hex and alpha
                rgb = hexToRGB(arguments[0]);
                this.context2D.fillStyle = "rgba(" + rgb.r + "," + rgb.g + "," + rgb.b + "," + arguments[1] + ")";
            } else if (arguments.length == 3) {
                //three strings, rgb
                this.context2D.fillStyle = "rgb(" + arguments[0] + "," + arguments[1] + "," + arguments[2] + ")";
            } else if (arguments.length == 4) {
                //r,g,b,a
                this.context2D.fillStyle = "rgba(" + arguments[0] + "," + arguments[1] + "," + arguments[2] + "," + arguments[3] + ")";
            }
        },

        setGlobalAlpha: function() {
            this.context2D.globalAlpha = arguments[0];
        },

        //drawing functions
        drawRect: function() {
            this.drawFillRect.apply(this, arguments);
        },
        drawFillRect: function(x,y,dx,dy) {
            //arguments = this.translateCoords(x,y,dx,dy);
            this.context2D.fillRect(x,y,dx,dy);
        },

        pixelDraw: function() {
            var canvasData = this.context2D.getImageData(0, 0, 1000, 1000);
            for (var x = 0; x < 100; x++) {
                for (var y = 0; y < 100; y++) {
                    // Index of the pixel in the array
                    var idx = (x + y * 1000) * 4;
                    canvasData.data[idx + 0] = 0;
                    canvasData.data[idx + 1] = 255;
                    canvasData.data[idx + 2] = 0;
                    canvasData.data[idx + 3] = 255;
                    canvasData.data[idx + 4] = 0;
                    canvasData.data[idx + 5] = 255;
                    canvasData.data[idx + 6] = 0;
                    canvasData.data[idx + 7] = 255;
                    canvasData.data[idx + 8] = 0;
                    canvasData.data[idx + 9] = 255;
                    canvasData.data[idx + 10] = 0;
                    canvasData.data[idx + 11] = 255;
                    canvasData.data[idx + 12] = 0;
                    canvasData.data[idx + 13] = 255;
                    canvasData.data[idx + 14] = 0;
                    canvasData.data[idx + 15] = 255;
                }
            }
            this.context2D.putImageData(canvasData, 0, 0);
        },

        pathDraw: function() {
            this.context2D.beginPath();
            for (var x = 0; x < 100; x++) {
                for (var y = 0; y < 100; y++) {
                    this.context2D.moveTo(30,30);
                    this.context2D.lineTo(30,40);
                    this.context2D.lineTo(40,40);
                    this.context2D.lineTo(40,30);
                }
            }
            this.context2D.fill();
        }

    });
    var renderer;

    jQuery( function($) {
        renderer = new Renderer("#teken");
        renderer.clear();
        startTime = new Date().getTime(); //for benchmarking
        //draw some stuff
        
        for(i=0;i<10000;i++) { renderer.drawFillRect(20.345,20.5565,20.4567,20.55654); } //33 approx
        //renderer.pathDraw();
        //renderer.pixelDraw();
        //end
        stopTime = new Date().getTime();
        alert(stopTime - startTime);
    });
    </script>
        
</head>
<body>
    <canvas id='teken' height="1000" width="1000" style='width: 1000px; height: 1000px;'>
    </canvas>
</body>


</html>
